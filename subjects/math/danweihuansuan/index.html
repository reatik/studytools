<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四年级数学单位换算练习</title>
    <style>
:root {
    --primary-color: #2e7d32;
    --secondary-color: #4caf50;
    --success-color: #388e3c;
    --danger-color: #d32f2f;
    --light-color: #f1f8e9;
    --dark-color: #1b5e20;
    --disabled-color: #e0e0e0;
    --unit-selected-color: #689f38;
    --text-color: #424242;
    --border-color: #c8e6c9;
    --highlight-color: #8bc34a;
    --background-color: #fafafa;
    --length-zero-color: #ffcc80;
    --other-zero-color: #80cbc4;
}

/* 基础样式 */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: var(--background-color);
}


h1 {
    text-align: center;  /* 使标题居中 */
    margin: 20px 0;      /* 添加上下边距 */
    color: var(--primary-color);  /* 使用主题色 */
    font-size: 1.5rem;   /* 调整字体大小 */
    font-weight: 600;    /* 调整字体粗细 */
}

.container {
    max-width: 100%;
    margin: 0 auto;
    padding: 15px;
}

.app-container {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 20px;
}

.page {
    display: none;
}

.page.active {
    display: block;
}

/* 单位选择器 */
.unit-selector {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin: 30px 0;
    justify-content: center;
}

.unit-option {
    position: relative;
    width: 140px;
}

.unit-option input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.unit-label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    background-color: white;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 60px;
    box-sizing: border-box;
    color: var(--text-color);
    font-weight: 500;
    position: relative;
    overflow: hidden;
}

.unit-option input:checked + .unit-label {
    background-color: white;
    color: var(--unit-selected-color);
    border-color: var(--unit-selected-color);
    box-shadow: 0 4px 12px rgba(104, 159, 56, 0.2);
    transform: translateY(-2px);
}

.unit-option input:checked + .unit-label::before {
    content: '✓';
    position: absolute;
    top: 0;
    left: 0;
    width: 24px;
    height: 24px;
    background-color: var(--unit-selected-color);
    color: white;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom-right-radius: 8px;
    animation: checkmarkAppear 0.3s ease;
}

@keyframes checkmarkAppear {
    from {
        transform: scale(0) rotate(-30deg);
        opacity: 0;
    }
    to {
        transform: scale(1) rotate(0);
        opacity: 1;
    }
}

.unit-option:hover .unit-label {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* 按钮样式 */
.button-group {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin: 25px 0;
}

button {
    padding: 14px 20px;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    width: calc(50% - 15px);
    max-width: 200px;
    border: 2px solid var(--primary-color);
    background-color: white;
    color: var(--primary-color);
    box-sizing: border-box;
    transition: all 0.3s ease;
    font-weight: 600;
}

button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(46, 125, 50, 0.2);
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
    box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
}

.btn-primary:hover {
    background-color: var(--secondary-color);
    box-shadow: 0 6px 12px rgba(46, 125, 50, 0.4);
}

/* 答题区域 */
.question-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 50px 0 0 0;
    flex-wrap: nowrap;
    overflow: hidden;
}

.question-text {
    font-size: 1.5rem;
    margin-right: 15px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
}

input {
    font-size: 1.5rem;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    width: 150px;
    text-align: center;
    transition: all 0.3s ease;
}

input:focus {
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
    outline: none;
}

.unit-text {
    font-size: 1.5rem;
    margin-left: 15px;
    white-space: nowrap;
    font-weight: 500;
}

.result-icon {
    font-size: 2rem;
    margin-left: 15px;
    display: none;
    animation: bounceIn 0.5s;
}

@keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
}

.correct-icon {
    color: var(--success-color);
}

.incorrect-icon {
    color: var(--danger-color);
}

/* 统计区域 */
.stats-container {
    text-align: center;
    margin: 15px 0;
}

.stats {
    display: inline-block;
    padding: 12px 24px;
    font-size: 0.9rem;

}

#correct-summary {
    color: var(--success-color);
    font-weight: bold;
}

#wrong-summary {
    color: var(--danger-color);
    font-weight: bold;
}

/* 表格样式 */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 25px 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    overflow: hidden;
}

th, td {
    border: 1px solid #e0e0e0;
    padding: 12px;
    text-align: left;
}

th {
    background-color: var(--light-color);
    font-weight: 600;
}

.correct-row {
    color: var(--success-color);
    background-color: rgba(56, 142, 60, 0.05);
}

.incorrect-row {
    color: var(--danger-color);
    background-color: rgba(229, 57, 53, 0.05);
}

.correct-answer {
    color: var(--success-color);
    display: block;
    width: 100%;
    padding: 0;           /* 清除内边距 */
    white-space: normal;
    text-align: center;    /* 文本居中 */
    font-size: 1.2rem;
}

/* 进率图样式 */
.conversion-chart {
    margin: 20px 0;
}

.conversion-row {
    display: flex;
    align-items: center;
    margin: 10px 0;
    overflow-x: auto;
    padding-bottom: 10px;
    -webkit-overflow-scrolling: touch;
    white-space: nowrap;
}

.unit-box {
    padding: 8px 12px;
    background-color: white;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    text-align: center;
    font-weight: bold;
    min-width: 100px;
    margin-right: 5px;
    display: inline-block;
}

.zero-box {
    display: flex;
    min-width: 100px;
    margin-right: 5px;
    gap: 2px;
}

.zero-part {
    flex: 1;
    padding: 8px 0;
    text-align: center;
    font-weight: bold;
    border-radius: 3px;
    min-width: 30px;
}

.length-zero {
    background-color: var(--length-zero-color);
}

.other-zero {
    background-color: var(--other-zero-color);
}

/* 移动端响应式 */
@media (max-width: 600px) {
    .container {
        padding: 15px;
    }
    
    .app-container {
        padding: 15px;
    }
    
    .question-text, .unit-text {
        font-size: 0.9rem;
    }
    
    input {
        font-size: 1.1rem;
        width: 100px;
        padding: 8px;
    }
    
    .correct-answer {
        display: block;
        width: 100%;
        margin: 10px 0 0 0;
        white-space: normal;
        text-align: center;
        font-size: 1.0rem;
    }
    
    .result-icon {
        margin-left: 0;
    }
    
    .question-container {
        flex-wrap: wrap;
        justify-content: flex-start;
        padding: 15px;
    }
    
    button {
        padding: 12px;
        font-size: 0.9rem;
        width: calc(50% - 6px);
        min-width: auto;
    }
    
    .unit-selector {
        gap: 10px;
    }
    
    .unit-option {
        width: calc(50% - 10px);
    }
    
    .unit-label {
        padding: 12px;
        height: 50px;
        font-size: 0.9rem;
    }
    
    .settings {
        padding: 15px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="app-container">
            <!-- 设置页面 -->
            <div id="settings-page" class="page active">
                <h1>单位换算练习</h1>
                
                <div class="settings">
                    
                    <div class="unit-selector">
                        <label class="unit-option">
                            <input type="checkbox" id="length-checkbox" checked>
                            <span class="unit-label">长度单位</span>
                        </label>
                        
                        <label class="unit-option">
                            <input type="checkbox" id="area-checkbox" checked>
                            <span class="unit-label">面积单位</span>
                        </label>
                        
                        <label class="unit-option">
                            <input type="checkbox" id="volume-checkbox">
                            <span class="unit-label">体积单位</span>
                        </label>

                        <label class="unit-option">
                            <input type="checkbox" id="weight-checkbox" checked>
                            <span class="unit-label">重量单位</span>
                        </label>
                        
                        <label class="unit-option">
                            <input type="checkbox" id="time-checkbox">
                            <span class="unit-label">时间单位</span>
                        </label>
                    </div>
                    
                    <div class="button-group">
                        <button id="start" class="btn-primary">开始练习</button>
                    </div>
                </div>
            </div>
            
            <!-- 答题页面 -->
            <div id="quiz-page" class="page">
                <div class="question-container">
                    <div class="question-text" id="question-text">题目加载中...</div>
                    <input type="text" id="answer" placeholder="">
                    <div class="unit-text" id="unit-text"></div>
                    <span class="result-icon" id="result-icon"></span>
                </div>
                
                <div class="stats-container">
                    <div class="stats" id="stats-summary">
                        正确: <span id="correct-summary">0</span> / 错误: <span id="wrong-summary">0</span>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="submit" class="btn-primary">提交</button>
                    <button id="next" class="btn-primary" style="display: none;">下一题</button>
                    <button id="show-conversion">进率图</button>
                    <button id="show-detail">答题记录</button>
                    <button id="back-to-settings">返回设置</button>
                </div>
            </div>
            
            <!-- 详情页面 -->
            <div id="detail-page" class="page">
                <h2>答题详情</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>题目</th>
                            <th>你的答案</th>
                            <th>正确答案</th>
                            <th>结果</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                    </tbody>
                </table>
                
                <div class="button-group">
                    <button id="back-to-quiz" class="btn-primary">返回答题</button>
                </div>
            </div>
            
            <!-- 进率页面 -->
            <div id="conversion-page" class="page">
                <h2>单位换算进率图</h2>
                
                <div class="conversion-chart">
                    <h3>长度单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">千米 (km)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">米 (m)</div>
                        <div class="zero-box">
                            <div class="zero-part length-zero">0</div>
                        </div>
                        <div class="unit-box">分米 (dm)</div>
                        <div class="zero-box">
                            <div class="zero-part length-zero">0</div>
                        </div>
                        <div class="unit-box">厘米 (cm)</div>
                        <div class="zero-box">
                            <div class="zero-part length-zero">0</div>
                        </div>
                        <div class="unit-box">毫米 (mm)</div>
                    </div>
                    
                    <h3>面积单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">平方千米 (km²)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">平方米 (m²)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">平方分米 (dm²)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">平方厘米 (cm²)</div>
                    </div>
                    
                    <h3>体积单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">立方千米 (km³)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">立方米 (m³)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">立方分米 (dm³)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">立方厘米 (cm³)</div>
                    </div>
                    
                    <h3>容积单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">升 (L)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">毫升 (mL)</div>
                    </div>
                    
                    <h3>重量单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">吨 (t)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">千克 (kg)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">克 (g)</div>
                    </div>
                    
                    <h3>时间单位</h3>
                    <div class="conversion-row">
                        <div class="unit-box">小时 (h)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">分钟 (min)</div>
                        <div class="zero-box">
                            <div class="zero-part other-zero">0</div>
                        </div>
                        <div class="unit-box">秒 (s)</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="back-from-conversion" class="btn-primary">返回</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 单位定义和进率
        const unitDefinitions = {
            length: {
                units: ["千米", "米", "分米", "厘米", "毫米"],
                factors: [1000, 10, 10, 10],
                unitPairs: [
                    ["千米", "米"], ["米", "分米"], ["分米", "厘米"], ["厘米", "毫米"],
                    ["千米", "分米"], ["千米", "厘米"], ["千米", "毫米"],
                    ["米", "厘米"], ["米", "毫米"],
                    ["分米", "毫米"]
                ]
            },
            weight: {
                units: ["吨", "千克", "克"],
                factors: [1000, 1000],
                unitPairs: [
                    ["吨", "千克"], ["千克", "克"],
                    ["吨", "克"]
                ]
            },
            time: {
                units: ["小时", "分钟", "秒"],
                factors: [60, 60],
                unitPairs: [
                    ["小时", "分钟"], ["分钟", "秒"],
                    ["小时", "秒"]
                ]
            },
            area: {
                units: ["平方千米", "平方米", "平方分米", "平方厘米"],
                factors: [1000000, 100, 100],
                unitPairs: [
                    ["平方千米", "平方米"], ["平方米", "平方分米"], ["平方分米", "平方厘米"],
                    ["平方千米", "平方分米"], ["平方千米", "平方厘米"],
                    ["平方米", "平方厘米"]
                ],
                maxConversionSteps: 2
            },
            volume: {
                units: ["立方千米", "立方米", "立方分米", "立方厘米"],
                factors: [1000000000, 1000, 1000],
                unitPairs: [
                    ["立方千米", "立方米"], ["立方米", "立方分米"], ["立方分米", "立方厘米"],
                    ["立方千米", "立方分米"], ["立方千米", "立方厘米"],
                    ["立方米", "立方厘米"]
                ],
                maxConversionSteps: 3
            }
        };

        // 获取DOM元素
        const settingsPage = document.getElementById('settings-page');
        const quizPage = document.getElementById('quiz-page');
        const detailPage = document.getElementById('detail-page');
        const conversionPage = document.getElementById('conversion-page');
        const questionTextEl = document.getElementById('question-text');
        const unitTextEl = document.getElementById('unit-text');
        const answerEl = document.getElementById('answer');
        const resultIconEl = document.getElementById('result-icon');
        const submitBtn = document.getElementById('submit');
        const nextBtn = document.getElementById('next');
        const startBtn = document.getElementById('start');
        const showDetailBtn = document.getElementById('show-detail');
        const showConversionBtn = document.getElementById('show-conversion');
        const backToSettingsBtn = document.getElementById('back-to-settings');
        const backToQuizBtn = document.getElementById('back-to-quiz');
        const backFromConversionBtn = document.getElementById('back-from-conversion');
        const lengthCheckbox = document.getElementById('length-checkbox');
        const weightCheckbox = document.getElementById('weight-checkbox');
        const timeCheckbox = document.getElementById('time-checkbox');
        const areaCheckbox = document.getElementById('area-checkbox');
        const volumeCheckbox = document.getElementById('volume-checkbox');
        const correctSummary = document.getElementById('correct-summary');
        const wrongSummary = document.getElementById('wrong-summary');
        const historyTableBody = document.getElementById('history-table-body');

        // 初始化变量
        let currentQuestion = null;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let questionHistory = [];
        let autoNextTimer = null;
        let currentUnitType = null;

        function generateQuestion() {
            // 收集所有选中的单位类型
            const selectedTypes = [];
            if (lengthCheckbox.checked) selectedTypes.push('length');
            if (weightCheckbox.checked) selectedTypes.push('weight');
            if (timeCheckbox.checked) selectedTypes.push('time');
            if (areaCheckbox.checked) selectedTypes.push('area');
            if (volumeCheckbox.checked) selectedTypes.push('volume');
            
            if (selectedTypes.length === 0) return null;
            
            // 随机选择一个单位类型
            currentUnitType = selectedTypes[Math.floor(Math.random() * selectedTypes.length)];
            
            // 获取该类型的单位和进率
            const units = unitDefinitions[currentUnitType].units;
            const factors = unitDefinitions[currentUnitType].factors;
            const unitPairs = unitDefinitions[currentUnitType].unitPairs;
            const maxSteps = unitDefinitions[currentUnitType].maxConversionSteps || 3;
            
            // 过滤单位对，确保不超过最大跨单位数
            const filteredPairs = unitPairs.filter(pair => {
                const fromIndex = units.indexOf(pair[0]);
                const toIndex = units.indexOf(pair[1]);
                return Math.abs(fromIndex - toIndex) <= maxSteps;
            });
            
            if (filteredPairs.length === 0) return null;
            
            // 随机选择一个单位对
            const pair = filteredPairs[Math.floor(Math.random() * filteredPairs.length)];
            const fromIndex = units.indexOf(pair[0]);
            const toIndex = units.indexOf(pair[1]);
            
            // 确定哪个是大单位，哪个是小单位
            const isFirstLarger = fromIndex < toIndex;
            const largerUnit = isFirstLarger ? pair[0] : pair[1];
            const smallerUnit = isFirstLarger ? pair[1] : pair[0];
            
            // 计算两个单位之间的总进率
            const actualLargerIndex = units.indexOf(largerUnit);
            const actualSmallerIndex = units.indexOf(smallerUnit);
            
            let conversionFactor = 1;
            for (let i = actualLargerIndex; i < actualSmallerIndex; i++) {
                conversionFactor *= factors[i];
            }
            
            // 1. 先随机生成大单位的数值 (1-999)
            const largerValue = Math.floor(Math.random() * 999) + 1;
            
            // 2. 计算对应的小单位数值
            const smallerValue = largerValue * conversionFactor;
            
            // 3. 随机决定哪个作为题目，哪个作为答案
            const useLargerAsQuestion = Math.random() > 0.5;
            
            let question, answer, unit;
            if (useLargerAsQuestion) {
                // 大单位作为题目，小单位作为答案
                question = `${largerValue}${largerUnit} =`;
                answer = Math.round(smallerValue);
                unit = smallerUnit;
            } else {
                // 小单位作为题目，大单位作为答案
                question = `${smallerValue}${smallerUnit} =`;
                answer = Math.round(largerValue);
                unit = largerUnit;
            }
            
            // 确保答案符合要求
            if (answer <= 0) {
                return generateQuestion(); // 重新生成
            }
            
            return {
                question: question,
                answer: answer.toString(),
                unit: unit,
                type: currentUnitType,
                hasDecimal: false
            };
        }

        // 开始练习
        function startPractice() {
            // 检查是否至少选择了一个单位类型
            if (!lengthCheckbox.checked && !weightCheckbox.checked && !timeCheckbox.checked && 
                !areaCheckbox.checked && !volumeCheckbox.checked) {
                alert('请至少选择一种单位类型！');
                return;
            }
            
            // 重置统计和题目记录
            totalQuestions = 0;
            correctAnswers = 0;
            questionHistory = [];
            currentUnitType = null;
            updateStatsSummary();
            
            // 切换到答题页面
            showPage('quiz-page');
            
            // 开始第一题
            newQuestion();
        }

        // 显示新题目
        function newQuestion() {
            // 清除之前的自动跳转计时器
            if (autoNextTimer) {
                clearTimeout(autoNextTimer);
                autoNextTimer = null;
            }
            
            currentQuestion = generateQuestion();
            
            if (!currentQuestion) {
                questionTextEl.textContent = "无法生成题目，请选择其他单位类型";
                unitTextEl.textContent = '';
                return;
            }
            
            // 显示问题和单位
            questionTextEl.textContent = currentQuestion.question;
            unitTextEl.textContent = currentQuestion.unit;
            answerEl.value = '';
            resultIconEl.textContent = '';
            resultIconEl.className = 'result-icon';
            resultIconEl.style.display = 'none';
            
            // 移除之前的正确答案提示
            const existingCorrectAnswer = document.querySelector('.correct-answer');
            if (existingCorrectAnswer) {
                existingCorrectAnswer.remove();
            }
            
            // 切换按钮状态
            submitBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';
            
            // 聚焦输入框
            answerEl.focus();
        }

        // 检查答案
        function checkAnswer() {
            const userAnswer = answerEl.value.trim();
            const correctAnswer = currentQuestion.answer;
            
            // 记录答题
            totalQuestions++;
            const isCorrect = userAnswer === correctAnswer;
            if (isCorrect) {
                correctAnswers++;
            }
            
            // 添加到历史记录
            questionHistory.unshift({
                question: currentQuestion.question + ' ' + currentQuestion.unit,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect,
                index: totalQuestions
            });
            
            // 更新统计
            updateStatsSummary();
            
            // 显示结果图标
            resultIconEl.style.display = 'inline-block';
            if (isCorrect) {
                resultIconEl.textContent = '✓';
                resultIconEl.className = 'result-icon correct-icon';
                
                // 回答正确后1秒自动跳转下一题
                autoNextTimer = setTimeout(newQuestion, 1000);
            } else {
                resultIconEl.textContent = '✗';
                resultIconEl.className = 'result-icon incorrect-icon';
                
                // 显示正确答案
                const correctAnswerEl = document.createElement('div');
                correctAnswerEl.textContent = `正确答案: ${correctAnswer}`;
                correctAnswerEl.className = 'correct-answer';
                
                // 移除之前的正确答案提示
                const existingCorrectAnswer = document.querySelector('.correct-answer');
                if (existingCorrectAnswer) {
                    existingCorrectAnswer.remove();
                }
                
                // 添加到question-container后面
                const container = document.querySelector('.question-container');
                container.parentNode.insertBefore(correctAnswerEl, container.nextSibling);
            }
            
            // 切换按钮状态
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'inline-block';
        }

        // 更新简易统计
        function updateStatsSummary() {
            correctSummary.textContent = correctAnswers;
            wrongSummary.textContent = totalQuestions - correctAnswers;
        }

        // 显示详情
        function showDetail() {
            // 更新详情表格
            historyTableBody.innerHTML = '';
            questionHistory.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = item.isCorrect ? 'correct-row' : 'incorrect-row';
                
                row.innerHTML = `
                    <td>${questionHistory.length - index}</td>
                    <td>${item.question}</td>
                    <td>${item.userAnswer || '未回答'}</td>
                    <td>${item.correctAnswer}</td>
                    <td>${item.isCorrect ? '✓' : '✗'}</td>
                `;
                
                historyTableBody.appendChild(row);
            });
            
            // 切换到详情页面
            showPage('detail-page');
        }

        // 显示进率表
        function showConversion() {
            showPage('conversion-page');
        }

        // 页面切换
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // 初始化事件监听
        function initEventListeners() {
            startBtn.addEventListener('click', startPractice);
            submitBtn.addEventListener('click', checkAnswer);
            nextBtn.addEventListener('click', newQuestion);
            showDetailBtn.addEventListener('click', showDetail);
            showConversionBtn.addEventListener('click', showConversion);
            backToSettingsBtn.addEventListener('click', () => showPage('settings-page'));
            backToQuizBtn.addEventListener('click', () => showPage('quiz-page'));
            backFromConversionBtn.addEventListener('click', () => showPage('quiz-page'));
            
            // 回车键提交答案或下一题
            answerEl.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    if (submitBtn.style.display !== 'none') {
                        checkAnswer();
                    } else {
                        newQuestion();
                    }
                }
            });
            
            // 单位选择变化时检查开始按钮状态
            const checkboxes = document.querySelectorAll('.unit-option input');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
                    if (anyChecked) {
                        startBtn.classList.remove('btn-disabled');
                        startBtn.classList.add('btn-primary');
                    } else {
                        startBtn.classList.remove('btn-primary');
                        startBtn.classList.add('btn-disabled');
                    }
                });
            });
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            showPage('settings-page');
        });
    </script>
</body>
</html>
